<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Test</title>
    <style>
        body { padding: 20px; font-family: Arial; }
        .container { max-width: 500px; margin: 0 auto; }
        .form-group { margin-bottom: 15px; }
        input { width: 100%; padding: 8px; margin-top: 5px; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; cursor: pointer; margin: 5px; }
        .result { margin-top: 20px; padding: 10px; background: #f8f9fa; }
    </style>
</head>
<body>
    <div class="container">
        <h2>Test APIs</h2>
        
        <!-- User Signup/Login -->
        <div class="form-group">
            <label>Name:</label>
            <input type="text" id="name" value="John Doe">
        </div>
        <div class="form-group">
            <label>Email:</label>
            <input type="email" id="email" value="john@example.com">
        </div>
        <div class="form-group">
            <label>Password:</label>
            <input type="password" id="password" value="password123">
        </div>
        <div class="form-group">
            <label>Role:</label>
            <input type="text" id="role" value="provider">
        </div>
        <button onclick="signup()">Test Signup</button>
        <button onclick="login()">Test Login</button>

        <!-- Provider Details -->
        <div class="form-group">
            <label>Services (comma-separated):</label>
            <input type="text" id="services" value="Plumbing,Electrical,Carpentry">
        </div>
        <div class="form-group">
            <label>Location:</label>
            <input type="text" id="location" value="New York">
        </div>
        <div class="form-group">
            <label>Experience (years):</label>
            <input type="number" id="experience" value="5">
        </div>
        <button onclick="createProvider()">Create Provider</button>
        <button onclick="getProviders()">Get All Providers</button>

        <!-- Booking Test -->
        <div class="form-group">
            <label>Service:</label>
            <input type="text" id="bookingService" value="Plumbing">
        </div>
        <div class="form-group">
            <label>Date:</label>
            <input type="date" id="bookingDate">
        </div>
        <div class="form-group">
            <label>Time:</label>
            <input type="time" id="bookingTime">
        </div>
        <button onclick="createBooking()">Create Booking</button>
        <button onclick="getBookings()">Get All Bookings</button>

        <div id="result" class="result"></div>
    </div>

    <script>
        let authToken = ''; // Store JWT token after login

        function signup() {
            fetch('http://localhost:8080/api/auth/signup', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    name: document.getElementById('name').value,
                    email: document.getElementById('email').value,
                    password: document.getElementById('password').value,
                    role: document.getElementById('role').value
                })
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('result').innerText = JSON.stringify(data, null, 2);
            });
        }

        function login() {
            fetch('http://localhost:8080/api/auth/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    email: document.getElementById('email').value,
                    password: document.getElementById('password').value
                })
            })
            .then(response => response.json())
            .then(data => {
                authToken = data.token; // Store the token
                document.getElementById('result').innerText = JSON.stringify(data, null, 2);
            });
        }

        function createProvider() {
            if (!authToken) {
                return alert('Please login first!');
            }

            fetch('http://localhost:8080/api/providers', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${authToken}` // Send token in headers
                },
                body: JSON.stringify({
                    services: document.getElementById('services').value.split(','),
                    location: document.getElementById('location').value,
                    experience: parseInt(document.getElementById('experience').value),
                    userId: '123', // You should get the actual user ID after login, or use decoded token info
                    priceRange: {
                        min: 50,
                        max: 200
                    }
                })
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('result').innerText = JSON.stringify(data, null, 2);
            })
            .catch(error => {
                document.getElementById('result').innerText = 'Error: ' + error.message;
            });
        }

        function getProviders() {
            fetch('http://localhost:8080/api/providers')
            .then(response => response.json())
            .then(data => {
                document.getElementById('result').innerText = JSON.stringify(data, null, 2);
            })
            .catch(error => {
                document.getElementById('result').innerText = 'Error: ' + error.message;
            });
        }

        function createBooking() {
            if (!authToken) {
                return alert('Please login first!');
            }

            fetch('http://localhost:8080/api/bookings', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${authToken}` // Send token in headers
                },
                body: JSON.stringify({
                    service: document.getElementById('bookingService').value,
                    date: document.getElementById('bookingDate').value,
                    time: document.getElementById('bookingTime').value,
                    userId: '123',  // Should be the logged-in user's ID
                    providerId: '456' // The provider ID to be booked (this should come from available provider list or selected provider)
                })
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('result').innerText = JSON.stringify(data, null, 2);
            });
        }

        function getBookings() {
            fetch('http://localhost:8080/api/bookings')
            .then(response => response.json())
            .then(data => {
                document.getElementById('result').innerText = JSON.stringify(data, null, 2);
            });
        }
    </script>
</body>
</html>
